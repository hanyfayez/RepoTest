name: Build and Publish .NET Framework Library

on:
  push:
    branches:
      - main
      
env:
  PJ_NAME: TestLib/TestLib.csproj
  
jobs:
  build-and-publish:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Setup NuGet
        uses: NuGet/setup-nuget@v1

      - name: Restore NuGet packages
        run: nuget restore ${{ PJ_NAME }}

      - name: Build the project
        run: msbuild ${{ PJ_NAME }} /p:Configuration=Release

      - name: Pack the library
        run: nuget pack ${{ PJ_NAME }} -Prop Configuration=Release

      - name: Publish to GitHub Packages
        run: nuget push "*.nupkg" -Source "https://nuget.pkg.github.com/${{ github.repository_owner }}/index.json" -ApiKey ${{ secrets.GITHUB_TOKEN }}
